<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Siemens Energy Ikon</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        :root {
            --table-container-padding-top: 0px;
            --th-top: 0px;
        }
        body {
            background-color: #000000;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #e0e0e0;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        .container {
            width: 100%;
            height: 100vh;
            border: 2px solid #621d8a;
            border-radius: 10px;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            padding: 10px;
            box-sizing: border-box;
            padding-top: 180px;
            overflow: hidden;
        }
        .header {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            box-sizing: border-box;
            position: fixed;
            top: 0;
            background-color: #000000;
            z-index: 10;
        }
        .header-left {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 5px;
        }
        .header-left-logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .header img {
            width: 128px;
            height: 70px;
        }
        .logo-note {
            font-size: 10px;
            color: #e0e0e0;
            text-align: center;
            width: 100%;
        }
        .copyright-note {
            font-size: 10px;
            color: #e0e0e0;
        }
        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-right: 20px;
        }
        .header-right span, .header-right i {
            font-size: 14px;
            color: #e0e0e0;
            cursor: pointer;
        }
        .header-right i:hover, .fullscreen-icon:hover {
            color: #621d8a;
        }
        .fullscreen-icon {
            font-size: 16px;
            color: #e0e0e0;
            cursor: pointer;
        }
        .divider {
            width: 100%;
            height: 2px;
            background-color: #621d8a;
            margin: 0;
            position: fixed;
            top: 110px;
            z-index: 9;
        }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            margin-left: 10px;
            position: fixed;
            top: 120px;
            z-index: 9;
            overflow-x: auto;
            width: calc(100% - 40px);
        }
        .tabs::-webkit-scrollbar {
            height: 8px;
        }
        .tabs::-webkit-scrollbar-thumb {
            background-color: #621d8a;
            border-radius: 5px;
        }
        .tabs::-webkit-scrollbar-track {
            background-color: #2a2a2a;
        }
        .tab {
            padding: 10px 20px;
            background-color: #1a1a1a;
            border: 1px solid #621d8a;
            border-radius: 5px;
            cursor: pointer;
            white-space: nowrap;
            transition: background-color 0.3s;
        }
        .tab.active {
            background-color: #621d8a;
            color: #e0e0e0;
        }
        .tab:hover {
            background-color: #2a2a2a;
        }
        .tab-content {
            width: 100%;
            flex-grow: 1;
            padding: 20px;
            background-color: #1a1a1a;
            border-radius: 5px;
            height: calc(100vh - 160px);
            box-sizing: border-box;
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .table-container {
            width: 100%;
            max-height: calc(100vh - 200px);
            min-height: calc(100vh - 200px);
            overflow-x: auto;
            overflow-y: auto;
            scroll-behavior: smooth;
            will-change: transform;
            padding-top: var(--table-container-padding-top);
            padding-right: 17px;
        }
        .table-container::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        .table-container::-webkit-scrollbar-thumb {
            background-color: #621d8a;
            border-radius: 5px;
            min-height: 20px;
        }
        .table-container::-webkit-scrollbar-track {
            background-color: #2a2a2a;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            margin-top: -2px;
        }
        th, td {
            padding: 10px;
            border: 1px solid #621d8a;
            text-align: left;
            white-space: nowrap;
        }
        th {
            background-color: #2a2a2a;
            position: sticky;
            top: var(--th-top);
            z-index: 3;
            height: 40px;
            line-height: 40px;
        }
        tr:nth-child(even) {
            background-color: #222222;
        }
        .edit-btn, .new-record-btn {
            padding: 5px 10px;
            background-color: #621d8a;
            border: none;
            border-radius: 5px;
            color: #e0e0e0;
            cursor: pointer;
            margin: 2px;
            position: relative;
            z-index: 10001;
        }
        .modal {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        .modal-content {
            background-color: #1a1a1a;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            text-align: center;
            border: 1px solid #621d8a;
            box-sizing: border-box;
        }
        .new-record-form, .edit-form {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
        }
        .edit-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            width: 100%;
        }
        .edit-form h3 {
            grid-column: 1 / 3;
            margin-top: 10px;
            border-bottom: 1px solid #621d8a;
            padding-bottom: 5px;
        }
        .edit-form label, .edit-form input, .edit-form select {
            display: block;
            width: 100%;
        }
        .edit-form button {
            grid-column: 1 / 3;
        }
        .new-record-form label, .edit-form label {
            font-weight: bold;
            text-align: left;
        }
        .new-record-form input, .new-record-form select, .edit-form input, .edit-form select {
            padding: 5px;
            border: none;
            border-radius: 5px;
            background-color: #3c3c3c;
            color: #e0e0e0;
        }
        .new-record-form button, .edit-form button {
            padding: 10px;
            background-color: #621d8a;
            border: none;
            border-radius: 5px;
            color: #e0e0e0;
            cursor: pointer;
        }
        .send-email-btn {
            background-color: #4CAF50;
        }
        #email-result {
            margin-top: 10px;
            color: #4CAF50;
        }
        .status-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        .status-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            font-size: 11px;
            cursor: default;
            opacity: 0.8;
            white-space: nowrap;
        }
        .status-btn:hover {
            opacity: 1;
        }
        .fa-envelope.sent {
            color: #4CAF50;
        }
        .fa-envelope.not-sent {
            color: #808080;
        }
        .csv-file-item {
            padding: 8px 15px;
            background-color: #2a2a2a;
            border: 1px solid #621d8a;
            border-radius: 5px;
            margin-bottom: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .csv-file-item:hover {
            background-color: #3c3c3c;
        }
        .csv-file-content {
            display: none;
            margin-top: 20px;
        }
        .csv-file-content.active {
            display: block;
        }
    </style>
</head>
<body onload="toggleFullscreen(); initializeSorszamCounter(); loadRegistryData();">
    <div class="container" id="container">
        <div class="header">
            <div class="header-left">
                <div class="header-left-logo">
                    <img src="siemens-energy-logo.png" alt="Siemens Energy Logo">
                    <span class="copyright-note">© 2025 [A Neved]. Minden jog fenntartva. Engedély nélküli felhasználás tilos.</span>
                </div>
                <span class="logo-note">Ideiglenes logó, hamarosan változik</span>
            </div>
            <div class="header-right">
                <i class="fas fa-envelope" title="Üzenetek"></i>
                <i class="fas fa-question-circle" title="Segítség"></i>
                <span>v1.2.29</span>
                <i class="fas fa-expand fullscreen-icon" onclick="toggleFullscreen()" title="Teljes képernyő"></i>
            </div>
        </div>
        <div class="divider"></div>
        <div class="tabs">
            <div class="tab active" onclick="openTab('logisztikai-adatbazis')">Logisztikai adatbázis</div>
            <div class="tab" onclick="openTab('keretrendelések')">Keretrendelések</div>
            <div class="tab" onclick="openTab('szállítói-címjegyzék')">Szállítói címjegyzék</div>
            <div class="tab" onclick="openTab('anyagtörzs')">Anyagtörzs</div>
            <div class="tab" onclick="openTab('nyomonkövetési-listák')">Nyomonkövetési listák</div>
            <div class="tab" onclick="openTab('foglalások')">Foglalások</div>
            <div class="tab" onclick="openTab('statisztika')">Statisztika</div>
            <div class="tab" onclick="openTab('chat-lista')">Chat Lista</div>
            <div class="tab" onclick="openTab('felhasználó-kezelés')">Felhasználó kezelés</div>
            <div class="tab" onclick="openTab('hibajelentés-fejlesztési-javaslat')">Hibajelentés Fejlesztési javaslat</div>
            <div class="tab" onclick="openTab('registry-adatok')">Registry adatok</div>
        </div>

        <div class="tab-content active" id="logisztikai-adatbazis">
            <h2>Logisztikai adatbázis</h2>
            <button class="new-record-btn" onclick="openNewRecordModal()">Új rekord</button>
            <div class="status-buttons">
                <button class="status-btn" data-status="felvett" style="background-color: #FFFFFF; color: #000000;">Felvett</button>
                <button class="status-btn" data-status="ajanlatkikuldve" style="background-color: #FFFF00; color: #000000;">Ajánlatkérés kiküldve</button>
                <button class="status-btn" data-status="belsoszam" style="background-color: #808080; color: #FFFFFF;">Belső igényszám kitöltve</button>
                <button class="status-btn" data-status="po" style="background-color: #0000FF; color: #FFFFFF;">PO szám létrehozva</button>
                <button class="status-btn" data-status="beerkezett" style="background-color: #008000; color: #FFFFFF;">Tétel beérkezett</button>
                <button class="status-btn" data-status="megszakitva" style="background-color: #000000; color: #FFFFFF;">Megszakítva</button>
            </div>
            <div class="table-container">
                <table id="logisztikai-table">
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="select-all"></th>
                            <th>Műveleti</th>
                            <th>Sr.</th>
                            <th>Felvéve</th>
                            <th>Raktár</th>
                            <th>Kontírozás</th>
                            <th>Kontírozási név</th>
                            <th>Ak.</th>
                            <th>Megnevezés</th>
                            <th>Folyamat</th>
                            <th>Szállító</th>
                            <th>Sz.kód</th>
                            <th>Ajánlatszám</th>
                            <th>Mennyiség</th>
                            <th>Egység</th>
                            <th>Ár</th>
                            <th>EUR/HUF</th>
                            <th>BMIg.</th>
                            <th>PO</th>
                            <th>T.Szállítás</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr data-ajanlatkikuldve="false">
                            <td><input type="checkbox" class="select-row"></td>
                            <td>
                                <button class="edit-btn" onclick="openEditModal(this)">Szerkesztés</button>
                            </td>
                            <td>FR25#0001</td>
                            <td>2025.03.01</td>
                            <td>0060</td>
                            <td>2025.03.02</td>
                            <td>-</td>
                            <td><i class="fas fa-envelope not-sent" title="Levél küldése" onclick="sendEmailFromTable(this)"></i></td>
                            <td>Csavar M8</td>
                            <td>Beszerzés</td>
                            <td>Szállító 1</td>
                            <td>001</td>
                            <td>AJ123</td>
                            <td>100</td>
                            <td>DB.</td>
                            <td>50</td>
                            <td>EUR</td>
                            <td>2025.03.10</td>
                            <td>PO123</td>
                            <td>2025.03.15</td>
                        </tr>
                        <tr data-ajanlatkikuldve="false">
                            <td><input type="checkbox" class="select-row"></td>
                            <td>
                                <button class="edit-btn" onclick="openEditModal(this)">Szerkesztés</button>
                            </td>
                            <td>FR25#0002</td>
                            <td>2025.03.02</td>
                            <td>0350</td>
                            <td>2025.03.03</td>
                            <td>-</td>
                            <td><i class="fas fa-envelope not-sent" title="Levél küldése" onclick="sendEmailFromTable(this)"></i></td>
                            <td>Alátét M8</td>
                            <td>Gyártás</td>
                            <td>Szállító 2</td>
                            <td>002</td>
                            <td>AJ124</td>
                            <td>200</td>
                            <td>DB.</td>
                            <td>30</td>
                            <td>HUF</td>
                            <td>2025.03.12</td>
                            <td>PO124</td>
                            <td>2025.03.18</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="tab-content" id="keretrendelések">
            <h2>Keretrendelések</h2>
            <div class="table-container">
                <table id="keretrendelesek-table">
                    <thead>
                        <tr>
                            <th>Keretszám</th>
                            <th>Leírás</th>
                            <th>Érvényesség kezdete</th>
                            <th>Érvényesség vége</th>
                            <th>Szállító</th>
                        </tr>
                    </thead>
                    <tbody id="keretrendelesek-tbody"></tbody>
                </table>
            </div>
        </div>

        <div class="tab-content" id="szállítói-címjegyzék">
            <h2>Szállítói címjegyzék</h2>
            <div class="table-container">
                <table id="szallitoi-cimjegyzek-table">
                    <thead>
                        <tr>
                            <th>Szállító neve</th>
                            <th>Szállító kód</th>
                            <th>Ajánlat email cím</th>
                            <th>Kapcsolattartó</th>
                            <th>Telefonszám</th>
                        </tr>
                    </thead>
                    <tbody id="szallitoi-cimjegyzek-tbody"></tbody>
                </table>
            </div>
        </div>

        <div class="tab-content" id="registry-adatok">
            <h2>Registry adatok</h2>
            <div class="table-container">
                <div id="registry-file-list"></div>
                <div id="csv-file-content-container"></div>
            </div>
        </div>

        <div class="tab-content" id="anyagtörzs">
            <h2>Anyagtörzs</h2>
            <p>Itt lesz az Anyagtörzs tartalma.</p>
        </div>
        <div class="tab-content" id="nyomonkövetési-listák">
            <h2>Nyomonkövetési listák</h2>
            <p>Itt lesz a Nyomonkövetési listák tartalma.</p>
        </div>
        <div class="tab-content" id="foglalások">
            <h2>Foglalások</h2>
            <p>Itt lesz a Foglalások tartalma.</p>
        </div>
        <div class="tab-content" id="statisztika">
            <h2>Statisztika</h2>
            <p>Itt lesz a Statisztika tartalma.</p>
        </div>
        <div class="tab-content" id="chat-lista">
            <h2>Chat Lista</h2>
            <p>Itt lesz a Chat Lista tartalma.</p>
        </div>
        <div class="tab-content" id="felhasználó-kezelés">
            <h2>Felhasználó kezelés</h2>
            <p>Itt lesz a Felhasználó kezelés tartalma.</p>
        </div>
        <div class="tab-content" id="hibajelentés-fejlesztési-javaslat">
            <h2>Hibajelentés Fejlesztési javaslat</h2>
            <p>Itt lesz a Hibajelentés és Fejlesztési javaslat tartalma.</p>
        </div>

        <div class="modal" id="newRecordModal" style="display: none;">
            <div class="modal-content">
                <div class="new-record-form" id="newRecordForm">
                    <h2>Új rekord</h2>
                    <label for="rendeles-tipus">Rendeléstípus:</label>
                    <select id="rendeles-tipus" onchange="updateRaktarField(); updateKontirozasField();">
                        <option value="1">Keretrendelés</option>
                        <option value="2" selected>Anyagszámos rendelés</option>
                        <option value="3">Gépre kontírozott rendelés</option>
                        <option value="4">Területre kontírozott rendelés</option>
                        <option value="5">Beruházás</option>
                    </select>
                    <label for="new-raktar">Raktár:</label>
                    <div id="raktar-container"></div>
                    <label for="new-kontirozas">Kontírozás:</label>
                    <div id="kontirozas-container"></div>
                    <label for="new-megnevezes">Megnevezés:</label>
                    <input type="text" id="new-megnevezes" required>
                    <label for="new-folyamat">Folyamat:</label>
                    <select id="new-folyamat">
                        <option value="Beszerzés">Beszerzés</option>
                        <option value="Gyártás">Gyártás</option>
                    </select>
                    <label for="new-szallito">Szállító:</label>
                    <input type="text" id="new-szallito" required>
                    <label for="new-mennyiseg">Mennyiség:</label>
                    <input type="number" id="new-mennyiseg" required>
                    <label for="new-egyseg">Egység:</label>
                    <select id="new-egyseg">
                        <option value="DB.">DB.</option>
                        <option value="KG">KG</option>
                        <option value="M">M</option>
                    </select>
                    <button type="button" onclick="saveNewRecord()">Mentés</button>
                    <button type="button" onclick="closeModal('newRecordModal')">Bezárás</button>
                </div>
            </div>
        </div>

        <div class="modal" id="editModal" style="display: none;">
            <div class="modal-content">
                <div class="edit-form" id="editForm">
                    <h2 style="grid-column: 1 / 3;">Szerkesztés</h2>
                    <input type="hidden" id="edit-row-index">
                    <label for="edit-rendeles-tipus">Rendeléstípus:</label>
                    <select id="edit-rendeles-tipus" onchange="updateEditRaktarField(); updateEditKontirozasField();">
                        <option value="1">Keretrendelés</option>
                        <option value="2">Anyagszámos rendelés</option>
                        <option value="3">Gépre kontírozott rendelés</option>
                        <option value="4">Területre kontírozott rendelés</option>
                        <option value="5">Beruházás</option>
                    </select>
                    <label for="edit-raktar">Raktár:</label>
                    <div id="edit-raktar-container"></div>
                    <label for="edit-kontirozas">Kontírozás:</label>
                    <div id="edit-kontirozas-container"></div>
                    <label for="edit-megnevezes">Megnevezés:</label>
                    <input type="text" id="edit-megnevezes" required>
                    <label for="edit-folyamat">Folyamat:</label>
                    <select id="edit-folyamat">
                        <option value="Beszerzés">Beszerzés</option>
                        <option value="Gyártás">Gyártás</option>
                    </select>
                    <label for="edit-szallito">Szállító:</label>
                    <input type="text" id="edit-szallito" required>
                    <label for="edit-ajanlatszam">Ajánlatszám:</label>
                    <input type="text" id="edit-ajanlatszam">
                    <label for="edit-mennyiseg">Mennyiség:</label>
                    <input type="number" id="edit-mennyiseg" required>
                    <label for="edit-egyseg">Egység:</label>
                    <select id="edit-egyseg">
                        <option value="DB.">DB.</option>
                        <option value="KG">KG</option>
                        <option value="M">M</option>
                    </select>
                    <label for="edit-ar">Ár:</label>
                    <input type="number" id="edit-ar">
                    <label for="edit-eur-huf">EUR/HUF:</label>
                    <select id="edit-eur-huf">
                        <option value="EUR">EUR</option>
                        <option value="HUF">HUF</option>
                    </select>
                    <label for="edit-bmig">BMIg.:</label>
                    <input type="text" id="edit-bmig">
                    <label for="edit-po">PO:</label>
                    <input type="text" id="edit-po">
                    <label for="edit-t-szallitas">T.Szállítás:</label>
                    <input type="date" id="edit-t-szallitas">
                    <button type="button" onclick="saveEdit()">Mentés</button>
                    <button type="button" onclick="closeModal('editModal')">Bezárás</button>
                    <button type="button" class="send-email-btn" onclick="sendEmail()">Levél küldése</button>
                    <div id="email-result"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let teruletekGepek = {};
        let szallitoiCimjegyzek = [];
        let keretrendelesek = [];
        let sorszamCounter = 0;
        let currentRow;
        let registryData = [];

        function initializeSorszamCounter() {
            const table = document.querySelector('#logisztikai-table tbody');
            const rows = table.querySelectorAll('tr');
            let maxSorszam = 0;

            rows.forEach(row => {
                const sorszamText = row.cells[2].textContent;
                const sorszam = parseInt(sorszamText.replace('FR25#', ''));
                if (!isNaN(sorszam) && sorszam > maxSorszam) {
                    maxSorszam = sorszam;
                }
            });

            sorszamCounter = maxSorszam;
        }

        function loadRegistryData() {
            Papa.parse('https://raw.githubusercontent.com/csalanka/Logisztika2/main/data/csv_registry.csv', {
                download: true,
                header: true,
                complete: function(results) {
                    console.log('Betöltött adatok:', results.data);
                    if (results.data.length === 0) {
                        console.warn('A csv_registry.csv üres vagy hibás.');
                    }
                    registryData = results.data.filter(row => row['CSV_fajl'] && row['CSV_fajl'].trim() !== '');
                    if (registryData.length === 0) {
                        console.warn('Nem található érvényes CSV_fajl a registry-ben.');
                    }
                    displayRegistryFileNames();
                },
                error: function(error) {
                    console.error('Hiba a csv_registry.csv betöltésekor:', error);
                    const registryList = document.getElementById('registry-file-list');
                    registryList.innerHTML = '<p>Hiba a registry adatok betöltésekor: ' + error.message + '</p>';
                }
            });
        }

        function displayRegistryFileNames() {
            const registryList = document.getElementById('registry-file-list');
            registryList.innerHTML = '';

            if (registryData.length === 0) {
                registryList.innerHTML = '<p>Nincsenek fájlok a registry-ben.</p>';
                return;
            }

            registryData.forEach(item => {
                const fileName = item['CSV_fajl'];
                if (fileName) {
                    const fileItem = document.createElement('div');
                    fileItem.classList.add('csv-file-item');
                    fileItem.textContent = fileName;
                    fileItem.setAttribute('onclick', `showCsvContent('${fileName}')`);
                    registryList.appendChild(fileItem);

                    const contentDiv = document.createElement('div');
                    contentDiv.classList.add('csv-file-content');
                    contentDiv.id = `content-${fileName}`;
                    contentDiv.innerHTML = `
                        <div class="table-container">
                            <table id="table-${fileName}">
                                <thead></thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    `;
                    document.getElementById('csv-file-content-container').appendChild(contentDiv);
                }
            });
        }

        function showCsvContent(fileName) {
            const contents = document.querySelectorAll('.csv-file-content');
            contents.forEach(content => content.classList.remove('active'));

            const contentDiv = document.getElementById(`content-${fileName}`);
            if (contentDiv.querySelector('tbody').innerHTML === '') {
                loadCsvData(fileName);
            }
            contentDiv.classList.add('active');
        }

        function loadCsvData(fileName) {
            const table = document.getElementById(`table-${fileName}`);
            const thead = table.querySelector('thead');
            const tbody = table.querySelector('tbody');

            Papa.parse(`https://raw.githubusercontent.com/csalanka/Logisztika2/main/data/${fileName}.csv`, {
                download: true,
                header: true,
                complete: function(results) {
                    // Használjuk a CSV fájl saját fejlécét
                    const columns = results.meta.fields || [];
                    thead.innerHTML = '<tr>' + columns.map(col => `<th>${col}</th>`).join('') + '</tr>';
                    tbody.innerHTML = '';

                    results.data.forEach(row => {
                        const tr = document.createElement('tr');
                        columns.forEach(col => {
                            const td = document.createElement('td');
                            td.textContent = row[col] || '-';
                            tr.appendChild(td);
                        });
                        tbody.appendChild(tr);
                    });
                },
                error: function(error) {
                    console.error(`Hiba a ${fileName}.csv betöltésekor:`, error);
                    tbody.innerHTML = '<tr><td colspan="100">Hiba az adatok betöltésekor.</td></tr>';
                }
            });
        }

        function openTab(tabName) {
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');

            tabs.forEach(tab => tab.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));

            document.querySelector(`.tab[onclick="openTab('${tabName}')"]`).classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        function toggleFullscreen() {
            const container = document.getElementById('container');
            if (!document.fullscreenElement) {
                container.requestFullscreen().catch(err => {
                    console.log(`Hiba a teljes képernyőre váltáskor: ${err}`);
                });
            } else {
                document.exitFullscreen();
            }

            requestAnimationFrame(() => {
                const newRecordBtn = document.querySelector('.new-record-btn');
                if (newRecordBtn) {
                    newRecordBtn.removeEventListener('click', openNewRecordModal);
                    newRecordBtn.addEventListener('click', () => openNewRecordModal());
                }

                const editButtons = document.querySelectorAll('.edit-btn');
                editButtons.forEach(btn => {
                    btn.removeEventListener('click', openEditModal);
                    btn.addEventListener('click', () => openEditModal(btn));
                });
            });
        }

        function openNewRecordModal() {
            const modal = document.getElementById('newRecordModal');
            modal.style.display = 'flex';
            updateRaktarField();
            updateKontirozasField();
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            document.getElementById('email-result').textContent = '';
        }

        function updateRaktarField() {
            const rendelesTipus = document.getElementById('rendeles-tipus').value;
            const raktarContainer = document.getElementById('raktar-container');
            raktarContainer.innerHTML = '';

            let options = [];
            if (rendelesTipus === '1') {
                options = ['0060', '0350', '0560', '0110'];
            } else if (rendelesTipus === '2') {
                options = ['0060', '0350', '0110', '0560'];
            } else if (rendelesTipus === '3') {
                options = ['0060', '0350', '0110', '0560'];
            } else if (rendelesTipus === '4') {
                options = ['0060', '0350', "0110", '0560'];
            } else if (rendelesTipus === '5') {
                options = ['0060', '0350', '0110', '0560'];
            }

            const select = document.createElement('select');
            select.id = 'new-raktar';
            select.name = 'new-raktar';
            select.required = true;
            options.forEach(option => {
                const opt = document.createElement('option');
                opt.value = option;
                opt.textContent = option;
                select.appendChild(opt);
            });
            raktarContainer.appendChild(select);
        }

        function updateKontirozasField() {
            const rendelesTipus = document.getElementById('rendeles-tipus').value;
            const kontirozasContainer = document.getElementById('kontirozas-container');
            kontirozasContainer.innerHTML = '';

            if (rendelesTipus === '3') {
                const teruletSelect = document.createElement('select');
                teruletSelect.id = 'new-terulet';
                teruletSelect.name = 'new-terulet';
                teruletSelect.onchange = updateGepSelect;

                const teruletOptionDefault = document.createElement('option');
                teruletOptionDefault.value = '';
                teruletOptionDefault.textContent = 'Válassz területet';
                teruletSelect.appendChild(teruletOptionDefault);

                Object.keys(teruletekGepek).forEach(terulet => {
                    const option = document.createElement('option');
                    option.value = terulet;
                    option.textContent = terulet;
                    teruletSelect.appendChild(option);
                });

                const hiddenInput = document.createElement('input');
                hiddenInput.type = 'hidden';
                hiddenInput.id = 'new-kontirozas';
                hiddenInput.name = 'new-kontirozas';

                kontirozasContainer.appendChild(teruletSelect);
                kontirozasContainer.appendChild(hiddenInput);
            } else if (rendelesTipus === '4') {
                const teruletSelect = document.createElement('select');
                teruletSelect.id = 'new-terulet';
                teruletSelect.name = 'new-terulet';
                teruletSelect.onchange = updateKontirozasValue;

                const teruletOptionDefault = document.createElement('option');
                teruletOptionDefault.value = '';
                teruletOptionDefault.textContent = 'Válassz területet';
                teruletSelect.appendChild(teruletOptionDefault);

                Object.keys(teruletekGepek).forEach(terulet => {
                    const option = document.createElement('option');
                    option.value = terulet;
                    option.textContent = terulet;
                    teruletSelect.appendChild(option);
                });

                const hiddenInput = document.createElement('input');
                hiddenInput.type = 'hidden';
                hiddenInput.id = 'new-kontirozas';
                hiddenInput.name = 'new-kontirozas';

                kontirozasContainer.appendChild(teruletSelect);
                kontirozasContainer.appendChild(hiddenInput);
            } else {
                const input = document.createElement('input');
                input.type = 'text';
                input.id = 'new-kontirozas';
                input.name = 'new-kontirozas';
                input.required = true;
                kontirozasContainer.appendChild(input);
            }
        }

        function updateGepSelect() {
            const terulet = document.getElementById('new-terulet').value;
            const gepSelect = document.getElementById('new-gep');
            if (!gepSelect) return;
            gepSelect.innerHTML = '';

            const gepOptionDefault = document.createElement('option');
            gepOptionDefault.value = '';
            gepOptionDefault.textContent = 'Válassz gépet';
            gepSelect.appendChild(gepOptionDefault);

            if (terulet && teruletekGepek[terulet]) {
                teruletekGepek[terulet].forEach(gep => {
                    const option = document.createElement('option');
                    option.value = gep.nev;
                    option.textContent = gep.nev;
                    gepSelect.appendChild(option);
                });
            }
        }

        function updateKontirozasValue() {
            const rendelesTipus = document.getElementById('rendeles-tipus').value;
            const kontirozasInput = document.getElementById('new-kontirozas');
            const terulet = document.getElementById('new-terulet').value;

            if (rendelesTipus === '3') {
                const gep = document.getElementById('new-gep').value;
                if (terulet && gep) {
                    const selectedGep = teruletekGepek[terulet].find(g => g.nev === gep);
                    if (selectedGep) {
                        kontirozasInput.value = selectedGep.rendelesiSzam && selectedGep.rendelesiSzam !== '-' ? selectedGep.rendelesiSzam : selectedGep.koltseghelySzam;
                    } else {
                        kontirozasInput.value = '';
                    }
                } else {
                    kontirozasInput.value = '';
                }
            } else if (rendelesTipus === '4') {
                if (terulet) {
                    const koltseghelySzam = teruletekGepek[terulet][0].koltseghelySzam;
                    kontirozasInput.value = koltseghelySzam;
                } else {
                    kontirozasInput.value = '';
                }
            }
        }

        function saveNewRecord() {
            const rendelesTipus = document.getElementById('rendeles-tipus').value;
            const raktar = document.getElementById('new-raktar').value;
            const kontirozas = document.getElementById('new-kontirozas').value;
            const megnevezes = document.getElementById('new-megnevezes').value;
            const folyamat = document.getElementById('new-folyamat').value;
            const szallito = document.getElementById('new-szallito').value;
            const mennyiseg = document.getElementById('new-mennyiseg').value;
            const egyseg = document.getElementById('new-egyseg').value;

            let kontirozasiNev = '-';
            if (rendelesTipus === '3') {
                const terulet = document.getElementById('new-terulet').value;
                const gep = document.getElementById('new-gep').value;
                if (terulet && gep) {
                    kontirozasiNev = gep;
                }
            }

            sorszamCounter++;
            const formattedSorszam = `FR25#${sorszamCounter.toString().padStart(4, '0')}`;

            const table = document.querySelector('#logisztikai-table tbody');
            const row = document.createElement('tr');
            row.setAttribute('data-ajanlatkikuldve', 'false');
            row.innerHTML = `
                <td><input type="checkbox" class="select-row"></td>
                <td>
                    <button class="edit-btn" onclick="openEditModal(this)">Szerkesztés</button>
                </td>
                <td>${formattedSorszam}</td>
                <td>${new Date().toISOString().split('T')[0]}</td>
                <td>${raktar}</td>
                <td>${kontirozas}</td>
                <td>${kontirozasiNev}</td>
                <td><i class="fas fa-envelope not-sent" title="Levél küldése" onclick="sendEmailFromTable(this)"></i></td>
                <td>${megnevezes}</td>
                <td>${folyamat}</td>
                <td>${szallito}</td>
                <td>${Math.floor(Math.random() * 1000).toString().padStart(3, '0')}</td>
                <td>-</td>
                <td>${mennyiseg}</td>
                <td>${egyseg}</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
            `;
            table.appendChild(row);
            closeModal('newRecordModal');
        }

        function openEditModal(button) {
            currentRow = button.parentElement.parentElement;
            const rowIndex = Array.from(currentRow.parentElement.children).indexOf(currentRow);

            document.getElementById('edit-row-index').value = rowIndex;
            const kontirozasText = currentRow.cells[5].textContent;
            let currentRendelesTipus = '2';
            if (Object.values(teruletekGepek).some(gepek => gepek.some(g => g.rendelesiSzam === kontirozasText || g.koltseghelySzam === kontirozasText))) {
                if (currentRow.cells[6].textContent !== '-' && currentRow.cells[6].textContent !== '') {
                    currentRendelesTipus = '3';
                } else {
                    currentRendelesTipus = '4';
                }
            }
            document.getElementById('edit-rendeles-tipus').value = currentRendelesTipus;

            updateEditRaktarField();
            updateEditKontirozasField();

            if (currentRendelesTipus === '3' || currentRendelesTipus === '4') {
                const selectedTerulet = Object.keys(teruletekGepek).find(terulet =>
                    teruletekGepek[terulet].some(gep =>
                        gep.rendelesiSzam === kontirozasText || gep.koltseghelySzam === kontirozasText
                    )
                );
                if (selectedTerulet) {
                    document.getElementById('edit-terulet').value = selectedTerulet;
                    if (currentRendelesTipus === '3') {
                        updateEditGepSelect();
                        const selectedGep = teruletekGepek[selectedTerulet].find(gep => gep.rendelesiSzam === kontirozasText || gep.koltseghelySzam === kontirozasText);
                        if (selectedGep) {
                            document.getElementById('edit-gep').value = selectedGep.nev;
                        }
                    }
                }
            }

            document.getElementById('edit-raktar').value = currentRow.cells[4].textContent;
            document.getElementById('edit-kontirozas').value = currentRow.cells[5].textContent;
            document.getElementById('edit-megnevezes').value = currentRow.cells[8].textContent;
            document.getElementById('edit-folyamat').value = currentRow.cells[9].textContent;
            document.getElementById('edit-szallito').value = currentRow.cells[10].textContent;
            document.getElementById('edit-ajanlatszam').value = currentRow.cells[12].textContent === '-' ? '' : currentRow.cells[12].textContent;
            document.getElementById('edit-mennyiseg').value = currentRow.cells[13].textContent;
            document.getElementById('edit-egyseg').value = currentRow.cells[14].textContent;
            document.getElementById('edit-ar').value = currentRow.cells[15].textContent === '-' ? '' : currentRow.cells[15].textContent;
            document.getElementById('edit-eur-huf').value = currentRow.cells[16].textContent === '-' ? 'EUR' : currentRow.cells[16].textContent;
            document.getElementById('edit-bmig').value = currentRow.cells[17].textContent === '-' ? '' : currentRow.cells[17].textContent;
            document.getElementById('edit-po').value = currentRow.cells[18].textContent === '-' ? '' : currentRow.cells[18].textContent;
            document.getElementById('edit-t-szallitas').value = currentRow.cells[19].textContent === '-' ? '' : currentRow.cells[19].textContent;

            document.getElementById('editModal').style.display = 'flex';
        }

        function updateEditRaktarField() {
            const rendelesTipus = document.getElementById('edit-rendeles-tipus').value;
            const raktarContainer = document.getElementById('edit-raktar-container');
            raktarContainer.innerHTML = '';

            let options = [];
            if (rendelesTipus === '1') {
                options = ['0060', '0350', '0560', '0110'];
            } else if (rendelesTipus === '2') {
                options = ['0060', '0350', '0110', '0560'];
            } else if (rendelesTipus === '3') {
                options = ['0060', '0350', '0110', '0560'];
            } else if (rendelesTipus === '4') {
                options = ['0060', '0350', "0110", '0560'];
            } else if (rendelesTipus === '5') {
                options = ['0060', '0350', '0110', '0560'];
            }

            const select = document.createElement('select');
            select.id = 'edit-raktar';
            select.name = 'edit-raktar';
            select.required = true;
            options.forEach(option => {
                const opt = document.createElement('option');
                opt.value = option;
                opt.textContent = option;
                select.appendChild(opt);
            });
            raktarContainer.appendChild(select);
        }

        function updateEditKontirozasField() {
            const rendelesTipus = document.getElementById('edit-rendeles-tipus').value;
            const kontirozasContainer = document.getElementById('edit-kontirozas-container');
            kontirozasContainer.innerHTML = '';

            if (rendelesTipus === '3') {
                const teruletSelect = document.createElement('select');
                teruletSelect.id = 'edit-terulet';
                teruletSelect.name = 'edit-terulet';
                teruletSelect.onchange = updateEditGepSelect;

                const teruletOptionDefault = document.createElement('option');
                teruletOptionDefault.value = '';
                teruletOptionDefault.textContent = 'Válassz területet';
                teruletSelect.appendChild(teruletOptionDefault);

                Object.keys(teruletekGepek).forEach(terulet => {
                    const option = document.createElement('option');
                    option.value = terulet;
                    option.textContent = terulet;
                    teruletSelect.appendChild(option);
                });

                const gepSelect = document.createElement('select');
                gepSelect.id = 'edit-gep';
                gepSelect.name = 'edit-gep';
                gepSelect.onchange = updateEditKontirozasValue;

                const gepOptionDefault = document.createElement('option');
                gepOptionDefault.value = '';
                gepOptionDefault.textContent = 'Válassz gépet';
                gepSelect.appendChild(gepOptionDefault);

                const hiddenInput = document.createElement('input');
                hiddenInput.type = 'hidden';
                hiddenInput.id = 'edit-kontirozas';
                hiddenInput.name = 'edit-kontirozas';

                kontirozasContainer.appendChild(teruletSelect);
                kontirozasContainer.appendChild(gepSelect);
                kontirozasContainer.appendChild(hiddenInput);
            } else if (rendelesTipus === '4') {
                const teruletSelect = document.createElement('select');
                teruletSelect.id = 'edit-terulet';
                teruletSelect.name = 'edit-terulet';
                teruletSelect.onchange = updateEditKontirozasValue;

                const teruletOptionDefault = document.createElement('option');
                teruletOptionDefault.value = '';
                teruletOptionDefault.textContent = 'Válassz területet';
                teruletSelect.appendChild(teruletOptionDefault);

                Object.keys(teruletekGepek).forEach(terulet => {
                    const option = document.createElement('option');
                    option.value = terulet;
                    option.textContent = terulet;
                    teruletSelect.appendChild(option);
                });

                const hiddenInput = document.createElement('input');
                hiddenInput.type = 'hidden';
                hiddenInput.id = 'edit-kontirozas';
                hiddenInput.name = 'edit-kontirozas';

                kontirozasContainer.appendChild(teruletSelect);
                kontirozasContainer.appendChild(hiddenInput);
            } else {
                const input = document.createElement('input');
                input.type = 'text';
                input.id = 'edit-kontirozas';
                input.name = 'edit-kontirozas';
                input.required = true;
                kontirozasContainer.appendChild(input);
            }
        }

        function updateEditGepSelect() {
            const terulet = document.getElementById('edit-terulet').value;
            const gepSelect = document.getElementById('edit-gep');
            gepSelect.innerHTML = '';

            const gepOptionDefault = document.createElement('option');
            gepOptionDefault.value = '';
            gepOptionDefault.textContent = 'Válassz gépet';
            gepSelect.appendChild(gepOptionDefault);

            if (terulet && teruletekGepek[terulet]) {
                teruletekGepek[terulet].forEach(gep => {
                    const option = document.createElement('option');
                    option.value = gep.nev;
                    option.textContent = gep.nev;
                    gepSelect.appendChild(option);
                });
            }
        }

        function updateEditKontirozasValue() {
            const rendelesTipus = document.getElementById('edit-rendeles-tipus').value;
            const kontirozasInput = document.getElementById('edit-kontirozas');
            const terulet = document.getElementById('edit-terulet').value;

            if (rendelesTipus === '3') {
                const gep = document.getElementById('edit-gep').value;
                if (terulet && gep) {
                    const selectedGep = teruletekGepek[terulet].find(g => g.nev === gep);
                    if (selectedGep) {
                        kontirozasInput.value = selectedGep.rendelesiSzam && selectedGep.rendelesiSzam !== '-' ? selectedGep.rendelesiSzam : selectedGep.koltseghelySzam;
                    } else {
                        kontirozasInput.value = '';
                    }
                } else {
                    kontirozasInput.value = '';
                }
            } else if (rendelesTipus === '4') {
                if (terulet) {
                    const koltseghelySzam = teruletekGepek[terulet][0].koltseghelySzam;
                    kontirozasInput.value = koltseghelySzam;
                } else {
                    kontirozasInput.value = '';
                }
            }
        }

        function saveEdit() {
            const rowIndex = document.getElementById('edit-row-index').value;
            const rendelesTipus = document.getElementById('edit-rendeles-tipus').value;
            const raktar = document.getElementById('edit-raktar').value;
            const kontirozas = document.getElementById('edit-kontirozas').value;
            const megnevezes = document.getElementById('edit-megnevezes').value;
            const folyamat = document.getElementById('edit-folyamat').value;
            const szallito = document.getElementById('edit-szallito').value;
            const ajanlatszam = document.getElementById('edit-ajanlatszam').value || '-';
            const mennyiseg = document.getElementById('edit-mennyiseg').value;
            const egyseg = document.getElementById('edit-egyseg').value;
            const ar = document.getElementById('edit-ar').value || '-';
            const eurHuf = document.getElementById('edit-eur-huf').value || '-';
            const bmig = document.getElementById('edit-bmig').value || '-';
            const po = document.getElementById('edit-po').value || '-';
            const tSzallitas = document.getElementById('edit-t-szallitas').value || '-';

            let kontirozasiNev = '-';
            if (rendelesTipus === '3') {
                const terulet = document.getElementById('edit-terulet').value;
                const gep = document.getElementById('edit-gep').value;
                if (terulet && gep) {
                    kontirozasiNev = gep;
                }
            }

            const table = document.querySelector('#logisztikai-table tbody');
            const row = table.children[rowIndex];
            row.cells[4].textContent = raktar;
            row.cells[5].textContent = kontirozas;
            row.cells[6].textContent = kontirozasiNev;
            row.cells[8].textContent = megnevezes;
            row.cells[9].textContent = folyamat;
            row.cells[10].textContent = szallito;
            row.cells[12].textContent = ajanlatszam;
            row.cells[13].textContent = mennyiseg;
            row.cells[14].textContent = egyseg;
            row.cells[15].textContent = ar;
            row.cells[16].textContent = eurHuf;
            row.cells[17].textContent = bmig;
            row.cells[18].textContent = po;
            row.cells[19].textContent = tSzallitas;

            closeModal('editModal');
        }

        function sendEmail() {
            const szallito = document.getElementById('edit-szallito').value;
            const emailResult = document.getElementById('email-result');
            const szallitoData = szallitoiCimjegyzek.find(s => s['Szállító neve'] === szallito);

            if (szallitoData && szallitoData['Ajánlat email cím']) {
                emailResult.textContent = `Levél elküldve a következő címre: ${szallitoData['Ajánlat email cím']}`;
                currentRow.setAttribute('data-ajanlatkikuldve', 'true');
                const envelopeIcon = currentRow.cells[7].querySelector('.fa-envelope');
                envelopeIcon.classList.remove('not-sent');
                envelopeIcon.classList.add('sent');
            } else {
                emailResult.textContent = 'Hiba: A szállító email címe nem található!';
                emailResult.style.color = 'red';
            }
        }

        function sendEmailFromTable(icon) {
            const row = icon.parentElement.parentElement;
            const szallito = row.cells[10].textContent;
            const szallitoData = szallitoiCimjegyzek.find(s => s['Szállító neve'] === szallito);

            if (szallitoData && szallitoData['Ajánlat email cím']) {
                alert(`Levél elküldve a következő címre: ${szallitoData['Ajánlat email cím']}`);
                row.setAttribute('data-ajanlatkikuldve', 'true');
                icon.classList.remove('not-sent');
                icon.classList.add('sent');
            } else {
                alert('Hiba: A szállító email címe nem található!');
            }
        }

        document.getElementById('select-all').addEventListener('change', function() {
            const checkboxes = document.querySelectorAll('.select-row');
            checkboxes.forEach(checkbox => {
                checkbox.checked = this.checked;
            });
        });
    </script>
</body>
</html>
